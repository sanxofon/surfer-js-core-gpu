<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script
      type="text/javascript"
      src="./vendor/CindyJS/v0.8.8/Cindy.js"
    ></script>
    <script
      type="text/javascript"
      src="./vendor/CindyJS/v0.8.8/CindyGL.js"
    ></script>
    <script
      type="text/javascript"
      src="./vendor/CindyJS/v0.8.8/symbolic.js"
    ></script>
    <style>
      .surface {
        width: 500px;
        height: 500px;
        display: inline-block;
        resize: both;
        overflow: auto;
      }

      .slider {
        width: 20px;
        height: 500px;
        writing-mode: bt-lr;
        -webkit-appearance: slider-vertical;
      }
    </style>
  </head>

  <body style="font-family: Arial">
    <div>
      <span id="container"></span>
      <input
        type="range"
        min="-0.2"
        value="1.0"
        max="1.2"
        step="0.001"
        class="slider"
        id="sliderParamA"
        orient="vertical"
      />
      <input
        type="range"
        min="0.3"
        value="1.0"
        max="1.0"
        step="0.001"
        class="slider"
        id="sliderAlpha"
        orient="vertical"
      />
      <input
        type="range"
        min="-3"
        value="-1.0"
        max="0.5"
        step="0.001"
        class="slider"
        id="sliderZoom"
        orient="vertical"
      />
    </div>

    <div style="margin-top: 20px">
      <label style="margin-right: 10px">
        Primary Color:
        <input
          type="color"
          id="colorPrimary"
          value="#4d80ff"
          title="Controls back lighting"
        />
      </label>
      <label style="margin-right: 10px">
        Accent Color:
        <input
          type="color"
          id="colorAccent"
          value="#ff3319"
          title="Controls front lighting and highlights"
        />
      </label>
      <label style="margin-right: 10px">
        Secondary Color:
        <input
          type="color"
          id="colorSecondary"
          value="#a3b845"
          title="Controls side lighting"
        />
      </label>
    </div>

    <input
      type="text"
      id="inp"
      value="(x^2+y^2+z^2-(0.5+a)^2)^2-(3*((0.5+a)^2)-1)/(3-((0.5+a)^2))*(1-z-sqrt(2)*x)*(1-z+sqrt(2)*x)*(1+z+sqrt(2)*y)*(1+z-sqrt(2)*y)"
      size="60"
    />

    <script type="module">
      import SurferCoreGpu from './dist/surfer-core-gpu-bundled-cindyjs.mjs';

      const container = document.getElementById('container');

      const input = document.getElementById('inp');

      const sliderParamA = document.getElementById('sliderParamA');
      const sliderAlpha = document.getElementById('sliderAlpha');
      const sliderZoom = document.getElementById('sliderZoom');
      const colorPrimary = document.getElementById('colorPrimary');
      const colorAccent = document.getElementById('colorAccent');
      const colorSecondary = document.getElementById('colorSecondary');

      // Helper function to convert hex color to RGB array (0-1 range)
      function hexToRgb(hex) {
        const r = parseInt(hex.slice(1, 3), 16) / 255;
        const g = parseInt(hex.slice(3, 5), 16) / 255;
        const b = parseInt(hex.slice(5, 7), 16) / 255;
        return [r, g, b];
      }

      async function init() {
        const surferCoreGpu = await SurferCoreGpu.create(container, 512, 512);
        surferCoreGpu.setExpression(input.value);
        surferCoreGpu.setParameter('a', sliderParamA.valueAsNumber);
        surferCoreGpu.setZoom(Math.pow(2, sliderZoom.valueAsNumber));
        surferCoreGpu.setAlpha(sliderAlpha.valueAsNumber);
        surferCoreGpu.element.classList.add('surface');
        console.log(surferCoreGpu);

        input.addEventListener('keypress', (event) =>
          event.code === 'Enter'
            ? surferCoreGpu.setExpression(input.value)
            : false,
        );
        sliderParamA.addEventListener('input', () =>
          surferCoreGpu.setParameter('a', sliderParamA.valueAsNumber),
        );
        sliderAlpha.addEventListener('input', () =>
          surferCoreGpu.setAlpha(sliderAlpha.valueAsNumber),
        );
        sliderZoom.addEventListener('input', () =>
          surferCoreGpu.setZoom(Math.pow(2, sliderZoom.valueAsNumber)),
        );
        colorPrimary.addEventListener('input', () =>
          surferCoreGpu.setPrimaryColor(hexToRgb(colorPrimary.value)),
        );
        colorAccent.addEventListener('input', () =>
          surferCoreGpu.setAccentColor(hexToRgb(colorAccent.value)),
        );
        colorSecondary.addEventListener('input', () =>
          surferCoreGpu.setSecondaryColor(hexToRgb(colorSecondary.value)),
        );
      }
      init().then();
    </script>
  </body>
</html>
